{% extends "layouts/base.html" %}

{% block title %}Crop Productivity Prediction{% endblock %}

{% block content %}

<div class="glass-card mx-auto">

    <i class="fa-solid fa-seedling icon-title"></i>
    <h2>Crop Productivity Prediction</h2>

    <form id="crop-form">

        <div class="form-floating mb-3">
            <input type="number" class="form-control" id="N" placeholder="Nitrogen" required>
            <label for="N"><i class="fa-solid fa-flask"></i> Nitrogen (N)</label>
        </div>

        <div class="form-floating mb-3">
            <input type="number" class="form-control" id="P" placeholder="Phosphorus" required>
            <label for="P"><i class="fa-solid fa-vial"></i> Phosphorus (P)</label>
        </div>

        <div class="form-floating mb-3">
            <input type="number" class="form-control" id="K" placeholder="Potassium" required>
            <label for="K"><i class="fa-solid fa-droplet"></i> Potassium (K)</label>
        </div>

        <div class="form-floating mb-3">
            <input type="number" class="form-control" id="temperature" placeholder="Temperature" required>
            <label for="temperature">
                <i class="fa-solid fa-temperature-half"></i> Temperature (°C)
            </label>
        </div>

        <div class="form-floating mb-3">
            <input type="number" class="form-control" id="humidity" placeholder="Humidity" required>
            <label for="humidity">
                <i class="fa-solid fa-water"></i> Humidity (%)
            </label>
        </div>

        <div class="form-floating mb-3">
            <input type="number" step="0.01" class="form-control" id="pH" placeholder="pH" required>
            <label for="pH">
                <i class="fa-solid fa-leaf"></i> pH Level
            </label>
        </div>

        <div class="form-floating mb-4">
            <input type="number" class="form-control" id="rainfall" placeholder="Rainfall" required>
            <label for="rainfall">
                <i class="fa-solid fa-cloud-rain"></i> Rainfall (mm)
            </label>
        </div>

        <button type="submit" class="btn btn-custom">
            <i class="fa-solid fa-seedling"></i> Predict Crop
        </button>

    </form>
</div>

{% endblock %}

{% block scripts %}
<script>
$("#crop-form").on("submit", function(event) {
    event.preventDefault();

    let formData = {
        N: $("#N").val(),
        P: $("#P").val(),
        K: $("#K").val(),
        temperature: $("#temperature").val(),
        humidity: $("#humidity").val(),
        pH: $("#pH").val(),
        rainfall: $("#rainfall").val()
    };

    // ✅ SAVE TO sessionStorage
    sessionStorage.setItem("cropFormData", JSON.stringify(formData));

    $.ajax({
        type: "POST",
        url: "/api/recommend_crop",
        contentType: "application/json",
        data: JSON.stringify(formData),
        success: function(response) {
            window.location.href = response.redirect_url;
        },
        error: function() {
            alert("Something went wrong. Please try again.");
        }
    });
});
</script>
<script>
$(document).ready(function () {
    const saved = sessionStorage.getItem("cropFormData");
    if (!saved) return;

    const data = JSON.parse(saved);

    Object.keys(data).forEach(key => {
        const input = document.getElementById(key);
        if (input) input.value = data[key];
    });
});
</script>
{% endblock %}
